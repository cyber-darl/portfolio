<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Peel Reveal - Bidirectional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #0f172a;
            min-height: 500vh;
        }
        
        .container {
            max-width: 100%;
            padding: 0;
        }
        
        header {
            text-align: center;
            padding: 100px 20px 150px;
            color: #f8fafc;
            background: #1e293b;
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #38bdf8, #818cf8);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(56, 189, 248, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #cbd5e1;
            max-width: 600px;
            margin: 0 auto 20px;
        }
        
        .content-section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #f8fafc;
            text-align: center;
            padding: 40px 20px;
            background: #1e293b;
        }
        
        .content-section h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #38bdf8;
        }
        
        .content-section p {
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
            color: #cbd5e1;
        }
        
        /* Image Section - The core of the effect */
        .image-section {
            position: relative;
            width: 100vw;
            height: 200vh; /* Enough for scroll range */
        }
        
        /* The main container that handles all states */
        .image-main-container {
            position: sticky;
            top: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Image containers */
        .image-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        /* Full width rectangular images */
        .full-width-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        /* Image 1 - Top layer, gets masked */
        .image-1 {
            z-index: 2;
            /* Mask will be applied via JavaScript */
        }
        
        /* Image 2 - Bottom layer, always fully visible */
        .image-2 {
            z-index: 1;
        }
        
        /* Content overlay for images */
        .image-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            z-index: 3;
            background: rgba(0, 0, 0, 0.5);
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            pointer-events: none; /* Don't interfere with scrolling */
        }
        
        .image-content h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: white;
        }
        
        .image-content p {
            font-size: 1.2rem;
            line-height: 1.6;
        }
        
        .image-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #38bdf8;
        }
        
        footer {
            text-align: center;
            padding: 100px 20px;
            color: #94a3b8;
            background: #1e293b;
            min-height: 100vh;
        }
        
        .scroll-direction {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-family: monospace;
            z-index: 1000;
        }
        
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: rgba(56, 189, 248, 0.2);
            z-index: 1000;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #38bdf8, #818cf8);
            width: 0%;
            transition: width 0.1s ease;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .image-content h2 {
                font-size: 2rem;
            }
            
            .image-content {
                padding: 30px 20px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .image-content h2 {
                font-size: 1.6rem;
            }
            
            .image-icon {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="progress-bar">
        <div class="progress"></div>
    </div>
    
    <div class="scroll-direction" id="scrollDirection">
        Direction: <span id="directionText">↓</span>
    </div>
    
    <div class="container">
        <header>
            <h1>Bidirectional Peel Reveal</h1>
            <p class="subtitle">Scroll down to peel, scroll up to unpeel. Works both ways naturally.</p>
        </header>
        
        <!-- First content section -->
        <section class="content-section">
            <div>
                <h2>Scroll Down to Peel</h2>
                <p>Scroll up to see the reverse effect. The peeling works bidirectionally.</p>
            </div>
        </section>
        
        <!-- Image Section - Only 2 images -->
        <section class="image-section" id="imageSection">
            <div class="image-main-container">
                <!-- Image 2 - Bottom layer -->
                <div class="image-layer image-2">
                    <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80" 
                         alt="Mountain Landscape" class="full-width-image">
                    <div class="image-content">
                        <div class="image-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <h2>Image Two</h2>
                        <p>Revealed when peeling down, hidden when peeling up.</p>
                    </div>
                </div>
                
                <!-- Image 1 - Top layer (only 2 images total) -->
                <div class="image-layer image-1" id="image1">
                    <img src="https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80" 
                         alt="Night Sky" class="full-width-image">
                    <div class="image-content">
                        <div class="image-icon">
                            <i class="fas fa-mountain"></i>
                        </div>
                        <h2>Image One</h2>
                        <p>Peels away when scrolling down, returns when scrolling up.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <footer>
            <h3>Scroll Up to See Reverse Effect</h3>
            <p>The peeling works in both directions - down to reveal, up to hide.</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const image1 = document.getElementById('image1');
            const imageSection = document.querySelector('.image-section');
            const directionText = document.getElementById('directionText');
            const scrollDirection = document.querySelector('.scroll-direction');
            
            let lastScrollPosition = window.pageYOffset;
            let currentPeelProgress = 0; // 0 to 1, where 0 = Image 1 fully visible, 1 = Image 2 fully visible
            
            function handleScroll() {
                const scrollPosition = window.pageYOffset;
                const windowHeight = window.innerHeight;
                const sectionTop = imageSection.offsetTop;
                const scrollPastSectionTop = scrollPosition - sectionTop;
                
                // Detect scroll direction
                const scrollDirectionIndicator = scrollPosition > lastScrollPosition ? 'down' : 'up';
                lastScrollPosition = scrollPosition;
                directionText.textContent = scrollDirectionIndicator === 'down' ? '↓' : '↑';
                
                // Update direction indicator color
                scrollDirection.style.backgroundColor = scrollDirectionIndicator === 'down' 
                    ? 'rgba(59, 130, 246, 0.7)' 
                    : 'rgba(34, 197, 94, 0.7)';
                
                // Calculate raw progress (0 to 1 over 100vh of the section)
                // 0 = at section top, 1 = 100vh past section top
                let rawProgress = scrollPastSectionTop / windowHeight;
                rawProgress = Math.max(0, Math.min(1, rawProgress));
                
                // Determine target progress based on scroll direction
                let targetProgress;
                if (scrollDirectionIndicator === 'down') {
                    // Scrolling down: progress increases
                    targetProgress = rawProgress;
                } else {
                    // Scrolling up: progress decreases
                    // When at top of section, we want progress = 0
                    // When 100vh down, we want progress = 1
                    // So scrolling up from bottom should decrease progress
                    targetProgress = rawProgress;
                }
                
                // Smoothly animate to target progress
                // This creates the natural feel when changing direction
                const smoothing = 0.2;
                currentPeelProgress += (targetProgress - currentPeelProgress) * smoothing;
                
                // Apply mask based on current progress
                // progress 0 = Image 1 fully visible (maskHeight = 100%)
                // progress 1 = Image 1 fully hidden (maskHeight = 0%)
                const maskHeight = 100 - (currentPeelProgress * 100);
                
                image1.style.maskImage = `linear-gradient(to top, 
                    black 0%, 
                    black ${maskHeight}%, 
                    transparent ${maskHeight}%, 
                    transparent 100%)`;
                image1.style.webkitMaskImage = `linear-gradient(to top, 
                    black 0%, 
                    black ${maskHeight}%, 
                    transparent ${maskHeight}%, 
                    transparent 100%)`;
                
                // Update progress bar
                const documentHeight = document.documentElement.scrollHeight;
                const scrollPercent = (scrollPosition / (documentHeight - windowHeight)) * 100;
                document.querySelector('.progress').style.width = scrollPercent + '%';
                
                // After peel completes (Image 2 fully visible), the container 
                // continues to be sticky at top, so Image 2 stays visible
                // as user continues to scroll down to footer
            }
            
            // Throttle scroll events for performance
            let scrollTimeout;
            function throttledHandleScroll() {
                if (!scrollTimeout) {
                    scrollTimeout = setTimeout(function() {
                        scrollTimeout = null;
                        handleScroll();
                    }, 10); // ~60fps
                }
            }
            
            window.addEventListener('scroll', throttledHandleScroll);
            window.addEventListener('resize', handleScroll);
            
            // Initialize
            handleScroll();
            
            // Hide direction indicator after 3 seconds
            setTimeout(() => {
                scrollDirection.style.opacity = '0.5';
                scrollDirection.style.transition = 'opacity 1s';
            }, 3000);
        });
    </script>
</body>
</html>